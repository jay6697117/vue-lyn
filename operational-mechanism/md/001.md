# JavaScript 运行机制

### 1. 单线程的JavaScript
- JavaScript是单线程的语言这，由它的用途决定的,作为浏览器的脚本语言，主要负责和用户交互，操作DOM。

- 假如JavaScript是多线程的，有两个线程同时操作一个DOM节点，一个负责删除DOM节点，一个在DOM节点上添加内容，浏览器该以哪个线程为标准呢？

- 所以，JavaScript的用途决定它只能是单线程的，过去是，将来也不会变。

> HTML5的Web Worker允许JavaScript主线程创建多个子线程，但是这些子线程完全受主线程的控制，且不可操作DOM节点，所以JavaScript单线程的本质并没有发生改变。


### 2. 同步任务和异步任务
- 所有的任务就可以分为两种，同步任务和异步任务，同步任务放在主线程中执行，异步任务被挂起，不进入主线程执行（进入主线程会让主线程阻塞等待），当其有结果了，再放入主线程中执行

### 3. 任务队列和Event Loop

#### 3.1 任务队列
- 任务队列是一个事件队列，也可以理解成消息队列，当挂起的异步任务就绪以后就会在任务队列中放置相应的事件，表示该任务可以进入主线程中执行了。

- 任务队列中的事件，除了IO设备的事件，还有网络请求，鼠标点击、滚动等，只要为事件指定过回调函数，这些事件发生时就会进入任务队列，等待主线程来读取，然后执行相应的回调函数。

- 回调函数其实就是被挂起来的异步任务，比如：Ajax请求，请求成功或失败以后执行的回调函数就是异步任务。

- 任务队列是一个先进先出的数据结构，排在前面的事件，只要主线程一空，就会优先被读取。

#### 3.2 Event Loop
- 主线程从任务队列读取事件，这个过程是循环不断的，所以JavaScript这种运行机制又称为Event Loop（事件循环）

### 4. 宏任务和微任务
- 异步任务可进一步划分为宏任务和微任务，相应的任务队列也有两种，分别为宏任务队列和微任务队列。

#### 4.1 宏任务
setTimeout、setInterval、setImmediate会产生宏任务

#### 4.2 微任务
- requestAnimationFrame、IO、读取数据、交互事件、UI render、Promise.then、MutationObserve、process.nextTick会产生微任务
